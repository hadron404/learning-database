tag::before[]
+--+-----------+-----+----------+------+-------------+-------+-------+------------------+----+--------+--------------------------------------------------+
|id|select_type|table|partitions|type  |possible_keys|key    |key_len|ref               |rows|filtered|Extra                                             |
+--+-----------+-----+----------+------+-------------+-------+-------+------------------+----+--------+--------------------------------------------------+
|1 |SIMPLE     |t5   |null      |const |PRIMARY      |PRIMARY|4      |const             |1   |100     |Using temporary; Using filesort                   |
|1 |SIMPLE     |t4   |null      |ALL   |null         |null   |null   |null              |27  |3.7     |Using where                                       |
|1 |SIMPLE     |t3   |null      |eq_ref|PRIMARY      |PRIMARY|8      |scrm.t4.CustomerId|1   |10      |Using where                                       |
|1 |SIMPLE     |t2   |null      |ALL   |null         |null   |null   |null              |104 |1       |Using where; Using join buffer (Block Nested Loop)|
|1 |SIMPLE     |t1   |null      |ALL   |null         |null   |null   |null              |1115|1       |Using where; Using join buffer (Block Nested Loop)|
+--+-----------+-----+----------+------+-------------+-------+-------+------------------+----+--------+--------------------------------------------------+
end::before[]

tag::first-refactor[]
+--+-----------+-----+----------+------+--------------------------------+---------------------+-------+------------------+----+--------+----------------------------------+
|id|select_type|table|partitions|type  |possible_keys                   |key                  |key_len|ref               |rows|filtered|Extra                             |
+--+-----------+-----+----------+------+--------------------------------+---------------------+-------+------------------+----+--------+----------------------------------+
|1 |SIMPLE     |t5   |null      |const |PRIMARY                         |PRIMARY              |4      |const             |1   |100     |Using temporary; Using filesort   |
|1 |SIMPLE     |t4   |null      |ALL   |Idx_WechatId,Idx_CustomerId     |null                 |null   |null              |27  |10      |Using where                       |
|1 |SIMPLE     |t3   |null      |eq_ref|PRIMARY                         |PRIMARY              |8      |scrm.t4.CustomerId|1   |10      |Using where                       |
|1 |SIMPLE     |t2   |null      |ref   |Idx_UserId,Idx_CustomerId_UserId|Idx_CustomerId_UserId|8      |scrm.t4.CustomerId|3   |10      |Using where                       |
|1 |SIMPLE     |t1   |null      |ref   |Idx_UserId                      |Idx_UserId           |1022   |scrm.t2.UserId    |1   |10      |Using index condition; Using where|
+--+-----------+-----+----------+------+--------------------------------+---------------------+-------+------------------+----+--------+----------------------------------+
end::first-refactor[]
